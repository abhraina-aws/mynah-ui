@import '../scss-variables';

.mynah-syntax-highlighter {
    display: flex;
    flex-flow: column nowrap;
    box-sizing: border-box;
    overflow: hidden;
    background-color: var(--mynah-card-bg);
    max-width: 100%;
    & + *:not(:empty) {
        margin-top: var(--mynah-sizing-2);
    }
    border: var(--mynah-border-width) solid var(--mynah-color-border-default);
    position: relative;
    border-radius: var(--mynah-input-radius);
    line-height: var(--mynah-syntax-code-line-height);
    color: var(--mynah-color-text-default);
    max-height: var(--mynah-syntax-code-block-max-height);

    &:before,
    & > .line-numbers-rows:before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: var(--mynah-color-syntax-bg);
        opacity: 0.2;
        pointer-events: none;
        user-select: none;
    }
    > .mynah-syntax-highlighter-copy-buttons {
        display: flex;
        flex-flow: row-reverse nowrap;
        align-items: center;
        justify-content: flex-end;
        padding: var(--mynah-sizing-half);
        padding-left: var(--mynah-sizing-3);
        order: 256000;
        box-sizing: border-box;
        margin: 0;
        margin-block: 0 !important;
        position: relative;
        border-top: 1px solid var(--mynah-color-border-default);
        &:before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: var(--mynah-color-border-default);
            opacity: 0.25;
        }
        > .mynah-syntax-highlighter-language {
            flex: 1;
            font-size: var(--mynah-font-size-xsmall);
            display: inline-block;
            opacity: 0.65;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .mynah-button {
            min-width: var(--mynah-sizing-6);
            height: calc(var(--mynah-sizing-6) + var(--mynah-sizing-half));
            * {
                font-size: var(--mynah-font-size-xsmall);
                color: var(--mynah-color-text-strong);
            }
        }
    }
    &.mynah-inline-code {
        display: inline-block;
        max-width: 100%;
        line-height: inherit;
        padding: 0 !important;
        margin: 0;
        margin-block-start: 0;
        margin-block-end: 0;
        overflow: visible;
        border: none;
        color: var(--mynah-color-syntax-attr);
        margin-left: 2px;
        margin-right: 2px;
        margin-top: -2px;
        background-color: transparent !important;
        vertical-align: middle;
        &,
        & > pre,
        & > pre > code {
            padding: 0;
            user-select: text;
            display: inline-block;
            position: relative;
            vertical-align: middle;
            white-space: normal;
            word-wrap: break-word;
            max-width: 100%;

            & * {
                white-space: normal;
            }
        }

        &:after,
        &:before {
            content: '';
            position: absolute;
            top: 50%;
            height: 100%;
            left: -3px;
            width: calc(100% + 6px);
            border-radius: var(--mynah-input-radius);
            box-sizing: border-box;
            transform: translateY(-50%);
        }
        &:after {
            border: var(--mynah-border-width) solid var(--mynah-color-border-default);
            background-color: var(--mynah-card-bg);
            z-index: -1;
        }
        &:before {
            background-color: var(--mynah-color-syntax-bg);
        }
    }
    > pre {
        padding: var(--mynah-sizing-2);
        margin: 0;
        overflow-x: auto;
        overflow-y: hidden;
        position: relative;

        *,
        & {
            font-size: var(--mynah-syntax-code-font-size) !important;
            font-family: var(--mynah-syntax-code-font-family) !important;
        }

        code {
            color: var(--mynah-color-syntax-code);
            filter: brightness(0.95);
            white-space: pre;
            background-color: inherit;

            @media (max-width: $mynah-code-blocks-wrap-under) {
                white-space: pre-wrap;
            }
        }

        > code,
        & {
            text-align: left;
            white-space: pre;
            word-spacing: normal;
            word-break: normal;
            word-wrap: normal;
            tab-size: 4;
            hyphens: none;

            @media (max-width: $mynah-code-blocks-wrap-under) {
                white-space: pre-wrap;
                word-wrap: break-word;
            }
        }

        .diff {
            position: absolute;
            top: 0;
            left: 0;
            padding: var(--mynah-sizing-2);
            background-color: transparent;
            color: transparent !important;

            .hljs-deletion {
                background-color: var(--mynah-color-syntax-deletion);
            }

            .hljs-addition {
                background-color: var(--mynah-color-syntax-addition);
            }
        }

        .hljs {
            color: var(--mynah-color-syntax-code);

            .hljs-comment,
            .hljs-quote {
                color: var(--mynah-color-syntax-comment);
                font-style: italic;
            }

            .hljs-doctag,
            .hljs-keyword,
            .hljs-formula {
                color: var(--mynah-color-syntax-keyword);
            }

            .hljs-section,
            .hljs-name,
            .hljs-selector-tag,
            .hljs-subst,
            .hljs-title.function_ {
                color: var(--mynah-color-syntax-function);
            }

            .hljs-literal,
            .hljs-property {
                color: var(--mynah-color-syntax-property);
            }

            .hljs-string,
            .hljs-regexp,
            .hljs-attribute,
            .hljs-meta .hljs-string {
                color: var(--mynah-color-syntax-string);
            }

            .hljs-attr,
            .hljs-variable,
            .hljs-template-variable,
            .hljs-type,
            .hljs-selector-class,
            .hljs-selector-attr,
            .hljs-selector-pseudo,
            .hljs-number {
                color: var(--mynah-color-syntax-variable);
            }

            .hljs-symbol,
            .hljs-bullet,
            .hljs-link,
            .hljs-meta,
            .hljs-selector-id,
            .hljs-title {
                color: var(--mynah-color-syntax-operator);
            }

            .hljs-built_in,
            .hljs-title.class_,
            .hljs-class .hljs-title {
                color: var(--mynah-color-syntax-class-name);
            }

            .hljs-emphasis {
                font-style: italic;
            }

            .hljs-strong {
                font-weight: bold;
            }

            .hljs-link {
                text-decoration: underline;
            }
        }

        > code::selection,
        &::selection {
            text-shadow: none;
            background: #b3d4fc;
        }

        &.line-numbers {
            position: relative;
            padding-left: 3.8em;
            counter-reset: linenumber;
            position: relative;
        }
    }
    > .line-numbers-rows {
        position: absolute;
        background-color: inherit;
        > span,
        & {
            pointer-events: none;
            user-select: none;
        }
        top: var(--mynah-sizing-2);
        font-size: 100%;
        left: 0;
        width: var(--mynah-sizing-12);
        overflow: hidden;
        text-overflow: clip;
        letter-spacing: -1px;
        border-right: 1px solid var(--mynah-color-border-default);

        > span {
            display: block;
            color: var(--mynah-color-border-default);
            padding-right: 0.8em;
            text-align: right;
        }
    }

    &.max-height-exceed {
        > pre {
            overflow-y: auto;
            padding-bottom: var(--mynah-sizing-4);
        }
    }
    > .more-content-indicator {
        padding: var(--mynah-sizing-2);
        justify-content: center;
        height: var(--mynah-sizing-9);
        margin-top: 0;
        box-shadow: 0 -15px 15px 0px var(--mynah-card-bg);
        background-color: var(--mynah-card-bg);
        &::before
        > .mynah-button {
            padding: var(--mynah-sizing-1);
            min-width: auto;
        }
    }

    &.no-max {
        max-height: initial;
        > pre {
            overflow-y: hidden;
        }
    }
}

.mynah-ui-syntax-highlighter-highlight-tooltip {
    max-width: 80vw;
    min-width: 10vw;
    max-height: 80vh;
    background-color: var(--mynah-card-bg);
    border-radius: var(--mynah-card-radius);
    border: var(--mynah-border-width) solid var(--mynah-color-border-default);
    padding: var(--mynah-sizing-5);

    .mynah-card-body {
        > p:first-child:last-of-type,
        > p p:first-child {
            margin: 0;
        }
    }
}
